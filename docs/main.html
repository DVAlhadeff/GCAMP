<!DOCTYPE html>

<html>
<head>
  <title>main.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="attributes.html">
                attributes.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="map.html">
                map.js
              </a>
            
              
              <a class="source" href="visibility.html">
                visibility.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>main.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>dojo.require(<span class="hljs-string">"esri.utils"</span>);
dojo.require(<span class="hljs-string">"esri.arcgis.utils"</span>);

dojo.require(<span class="hljs-string">"esri.geometry"</span>);
dojo.require(<span class="hljs-string">"esri.IdentityManager"</span>);

dojo.require(<span class="hljs-string">"dojo.store.Memory"</span>);
dojo.require(<span class="hljs-string">"dojo.data.ObjectStore"</span>);

dojo.require(<span class="hljs-string">"dijit.layout.AccordionContainer"</span>);
dojo.require(<span class="hljs-string">"dijit.layout.BorderContainer"</span>);
dojo.require(<span class="hljs-string">"dijit.layout.ContentPane"</span>);
dojo.require(<span class="hljs-string">"esri.map"</span>);

dojo.require(<span class="hljs-string">"esri.layers.FeatureLayer"</span>);
dojo.require(<span class="hljs-string">"esri.layers.WebTiledLayer"</span>);
dojo.require(<span class="hljs-string">"esri.layers.agsdynamic"</span>);

dojo.require(<span class="hljs-string">"esri.tasks.gp"</span>);
dojo.require(<span class="hljs-string">"esri.dijit.Legend"</span>);
dojo.require(<span class="hljs-string">"esri.dijit.Popup"</span>);
dojo.require(<span class="hljs-string">"esri.dijit.Measurement"</span>);
dojo.require(<span class="hljs-string">"esri.dijit.Print"</span>);

dojo.require(<span class="hljs-string">"esri.dijit.TimeSlider"</span>);

dojo.require(<span class="hljs-string">"dijit.form.DateTextBox"</span>);
dojo.require(<span class="hljs-string">"dijit.Toolbar"</span>);

dojo.require(<span class="hljs-string">"esri.toolbars.draw"</span>);
dojo.require(<span class="hljs-string">"esri.toolbars.navigation"</span>);
dojo.require(<span class="hljs-string">"dojo.number"</span>);

dojo.require(<span class="hljs-string">"dijit.form.Select"</span>);
dojo.require(<span class="hljs-string">"dijit.form.HorizontalSlider"</span>);

dojo.require(<span class="hljs-string">"dojox.layout.ContentPane"</span>);

dojo.require(<span class="hljs-string">"esri.tasks.identify"</span>);

dojo.require(<span class="hljs-string">"esri.layers.wms"</span>);

dojo.require(<span class="hljs-string">"dojox.xmpp.util"</span>);
dojo.require(<span class="hljs-string">"esri.dijit.BasemapGallery"</span>);

dojo.require(<span class="hljs-string">"esri.dijit.Scalebar"</span>);

<span class="hljs-keyword">var</span> map, legend;

<span class="hljs-keyword">var</span> mapBase = <span class="hljs-string">"http://carto.gis.gatech.edu/arcgis/rest/services/"</span>;
<span class="hljs-keyword">var</span> mapMarine = <span class="hljs-string">"http://www.csc.noaa.gov/ArcGISPUB/rest/services/MultipurposeMarineCadastre/MultipurposeMarineCadastre/MapServer/"</span>;

<span class="hljs-keyword">var</span> cartoLayers = [<span class="hljs-string">"NauticalChart522"</span>, <span class="hljs-string">"Habitat522"</span>, <span class="hljs-string">"Wetlands530"</span>, <span class="hljs-string">"CoastalResources61"</span>, <span class="hljs-string">"Physical522"</span>, <span class="hljs-string">"Counties531"</span>, <span class="hljs-string">"Administrative530"</span>];
<span class="hljs-keyword">var</span> marineLayers = [<span class="hljs-string">"2"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"5"</span>];
<span class="hljs-keyword">var</span> selectedNewMapSvc = ko.observable();

<span class="hljs-keyword">var</span> loaded = ko.observable();

<span class="hljs-keyword">var</span> timeSelValue = ko.observable();
<span class="hljs-keyword">var</span> timeSliderVisible = ko.observable(<span class="hljs-literal">false</span>);

<span class="hljs-keyword">var</span> mapSvrChoices = ko.observable(
[
	{id:<span class="hljs-number">1</span>, mapLabel:<span class="hljs-string">"Raster Nautical Charts (RNC)"</span>,url:<span class="hljs-string">"http://egisws02.nos.noaa.gov/ArcGIS/rest/services/RNC/NOAA_RNC/MapServer"</span>},
	{id:<span class="hljs-number">2</span>, mapLabel:<span class="hljs-string">"BOEM"</span>,url:<span class="hljs-string">"http://gis.boemre.gov/arcgis/rest/services/BOEM_BSEE/MMC_Layers/MapServer"</span>},
	{id:<span class="hljs-number">3</span>, mapLabel:<span class="hljs-string">"Marine Cadastre"</span>,url:<span class="hljs-string">"http://www.csc.noaa.gov/ArcGISPUB/rest/services/MultipurposeMarineCadastre/MultipurposeMarineCadastre/MapServer"</span>},</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>{id:4, mapLabel:”National Map”, url: “<a href="http://services.nationalmap.gov/ArcGIS/rest/services/&quot;}">http://services.nationalmap.gov/ArcGIS/rest/services/&quot;}</a>,
{id:5, mapLabel:”NOAA CMSP”, url: “”},</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	{id:<span class="hljs-number">5</span>, mapLabel:<span class="hljs-string">"SAFMC"</span>, url: <span class="hljs-string">"http://ocean.floridamarine.org/ArcGIS/rest/services/NauticalCharts/MapServer"</span>},
	{id:<span class="hljs-number">6</span>, mapLabel:<span class="hljs-string">"Carto/Coast"</span>, url: <span class="hljs-string">"http://carto.gis.gatech.edu/ArcGIS/rest/services/coastal113/MapServer"</span>}
]);

<span class="hljs-keyword">var</span> NOAA_NautChartURL = <span class="hljs-string">"http://egisws02.nos.noaa.gov/ArcGIS/rest/services/RNC/NOAA_RNC/MapServer"</span>;

<span class="hljs-keyword">var</span> extents = [];
	
<span class="hljs-keyword">var</span> initialExtent;

<span class="hljs-keyword">var</span> isSidebarVisible = ko.observable(<span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> currTab = ko.observable(<span class="hljs-string">"All Layers"</span>);
<span class="hljs-keyword">var</span> map_width = ko.observable(<span class="hljs-string">"100%"</span>);

<span class="hljs-keyword">var</span> identifyTask, identifyParams, symbol;
<span class="hljs-keyword">var</span> geometryService = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">var</span> navToolbar;
<span class="hljs-keyword">var</span> drwToolbar;
<span class="hljs-keyword">var</span> initBasemap;
<span class="hljs-keyword">var</span> ly_Energy;
<span class="hljs-keyword">var</span> ly_Habitat;
<span class="hljs-keyword">var</span> ly_DEM;

<span class="hljs-keyword">var</span> printer;
<span class="hljs-keyword">var</span> timeSlider;

<span class="hljs-keyword">var</span> MapSvcAllLayers = <span class="hljs-keyword">new</span> CreateCollection(<span class="hljs-string">"MapSvcList"</span>);

<span class="hljs-keyword">var</span> cMapTool = ko.observable( <span class="hljs-string">"pan"</span> );

<span class="hljs-keyword">var</span> generalTabController;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createBasemapGallery</span><span class="hljs-params">()</span> {</span>	
	<span class="hljs-keyword">var</span> basemaps = [];
	
	<span class="hljs-keyword">var</span> cmspBasemapLayers = [];
	
	<span class="hljs-keyword">var</span> cmspLayers = [
		{label: <span class="hljs-string">"Collision Regulation Lanes"</span>, url: <span class="hljs-string">"http://ocs-gis.ncd.noaa.gov/arcgis/rest/services/CMSP/Collision_regulation_lines/MapServer"</span>},
		{label: <span class="hljs-string">"Disposal Areas"</span>, url: <span class="hljs-string">"http://ocs-gis.ncd.noaa.gov/arcgis/rest/services/CMSP/Disposal_Areas/MapServer"</span>},
		{label: <span class="hljs-string">"Precautionary Areas"</span>, url: <span class="hljs-string">"http://ocs-gis.ncd.noaa.gov/arcgis/rest/services/CMSP/Precautionary_Areas/MapServer"</span>},
		{label: <span class="hljs-string">"Restricted Areas"</span>, url: <span class="hljs-string">"http://ocs-gis.ncd.noaa.gov/arcgis/rest/services/CMSP/Restricted_Areas/MapServer"</span>},
		{label: <span class="hljs-string">"Shipping Lanes"</span>, url: <span class="hljs-string">"http://ocs-gis.ncd.noaa.gov/arcgis/rest/services/CMSP/Shipping_Lanes/MapServer"</span>}
	];
	
	<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; cmspLayers.length; i++) {
		<span class="hljs-keyword">var</span> bm = <span class="hljs-keyword">new</span> esri.dijit.BasemapLayer({url: cmspLayers[i].url});
		cmspBasemapLayers.push(bm);
		
		<span class="hljs-keyword">var</span> cmspBasemap = <span class="hljs-keyword">new</span> esri.dijit.Basemap({
			layers : [bm],
			title : cmspLayers[i].label
		});
		
		basemaps.push(cmspBasemap);
	}
		
	<span class="hljs-keyword">var</span> basemapGallery = <span class="hljs-keyword">new</span> esri.dijit.BasemapGallery({
		showArcGISBasemaps : <span class="hljs-literal">true</span>,
		<span class="hljs-comment">/*"basemaps": basemaps, */</span>
		map: map,
	}, <span class="hljs-string">"basemapGallery"</span>);
	
	basemapGallery.startup();

	dojo.connect(basemapGallery, <span class="hljs-string">"onError"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err)</span> {</span> console.debug(error); });
	dojo.connect(basemapGallery, <span class="hljs-string">"onLoad"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>console.debug(“Load”);
dojo.byId(‘status’).setAttribute(“style”, “display: block”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	});
	
	dojo.connect(basemapGallery, <span class="hljs-string">"onSelectionChange"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
		console.debug(<span class="hljs-string">"OnSelectionChange"</span>);
		
		dojo.connect(basemapGallery.getSelected(), <span class="hljs-string">"onLoad"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
			console.debug(<span class="hljs-string">"Load"</span>);
			dojo.byId(<span class="hljs-string">'status'</span>).setAttribute(<span class="hljs-string">"style"</span>, <span class="hljs-string">"display: none"</span>);
		});
		
		init_layer_controls(map);
	});
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cvtLatLongExtent_2_WebMercator</span><span class="hljs-params">( extent, fn_when_finished )</span> {</span>
	<span class="hljs-keyword">var</span> geometryService = <span class="hljs-keyword">new</span> esri.tasks.GeometryService(<span class="hljs-string">"http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer"</span>);
	<span class="hljs-keyword">var</span> PrjParams = <span class="hljs-keyword">new</span> esri.tasks.ProjectParameters();
	PrjParams.geometries = [extent];
	PrjParams.outSR = <span class="hljs-keyword">new</span> esri.SpatialReference(<span class="hljs-number">3857</span>);

	geometryService.project(PrjParams, fn_when_finished );
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doMeasure</span><span class="hljs-params">(graphics)</span> {</span>
	<span class="hljs-keyword">if</span>(graphics[<span class="hljs-number">0</span>].geometry.type != <span class="hljs-string">"POLYGON"</span>) {
		<span class="hljs-keyword">var</span> geometryService = <span class="hljs-keyword">new</span> esri.tasks.GeometryService(<span class="hljs-string">"http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer"</span>);
		<span class="hljs-keyword">var</span> lp = <span class="hljs-keyword">new</span> esri.tasks.LengthsParameters();
		lp.polylines = graphics;
		lp.lengthUnit = esri.tasks.GeometryService.UNIT_FOOT;
		
		geometryService.lengths(lp, outputDistance);
	}
	<span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">var</span> geometryService = <span class="hljs-keyword">new</span> esri.tasks.GeometryService(<span class="hljs-string">"http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer"</span>);
		<span class="hljs-keyword">var</span> ap = <span class="hljs-keyword">new</span> esri.tasks.AreasAndLengthsParameters();
		ap.polygons = graphics;
		ap.areaUnit = esri.tasks.GeometryService.UNIT_ACRE;
		ap.lengthUnit = esri.tasks.GeometryService.UNIT_FOOT;
		
		geometryService.areasAndLengths(ap, outputDistance);
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hideDEMLayer</span><span class="hljs-params">()</span> {</span>
	map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).visibleLayers = [];
	map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).setVisibility(<span class="hljs-literal">false</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">outputDistance</span><span class="hljs-params">(result)</span> {</span>
	console.debug(result);
}

<span class="hljs-keyword">var</span> isMapGraphicsEmpty = ko.observable(<span class="hljs-literal">true</span>);
<span class="hljs-keyword">var</span> timeLayerIds = ko.observableArray([]);

<span class="hljs-built_in">require</span>([<span class="hljs-string">"esri/map"</span>, <span class="hljs-string">"http://esri.github.io/bootstrap-map-js/src/js/bootstrapmap.js"</span> ,<span class="hljs-string">"dojo/domReady!"</span>],
<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Map, BootstrapMap)</span> {</span>
	map = BootstrapMap.create(<span class="hljs-string">"map"</span>,{
	  basemap:<span class="hljs-string">"oceans"</span>,
	});
});

<span class="hljs-keyword">var</span> opacityControl = <span class="hljs-literal">null</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addOpacityControl</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> targetElem = dojo.byId(<span class="hljs-string">"RNC_opacity_control"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>var sliderElem = dojo.create(“div”, {id: “RNC_opacity_control_slider”}, targetElem, “first”);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	
	<span class="hljs-keyword">var</span> dynamicLayer = map.getLayer(<span class="hljs-string">"NauticalCharts"</span>);
	dynamicLayer.setOpacity( <span class="hljs-number">0</span> );
	
	$(<span class="hljs-string">"#RNC_opacity_control"</span>).slider({
		value: <span class="hljs-number">0</span>,
		min: <span class="hljs-number">0</span>,
		max: <span class="hljs-number">1</span>,
		step: <span class="hljs-number">0.05</span>,
		slide: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ev, ui)</span> {</span>
			dynamicLayer.setOpacity( ui.value );
		}
	});
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepare_map_when_extents_finished</span><span class="hljs-params">(a)</span> {</span>
		initialExtent = a[<span class="hljs-number">0</span>];
		
		map.setExtent(initialExtent);
		
		map.setMapCursor(<span class="hljs-string">"pointer"</span>);
		
		dojo.connect(map, <span class="hljs-string">"onMouseMove"</span>, showMouseCoordinates);
		dojo.connect(map, <span class="hljs-string">"onMouseDrag"</span>, showMouseCoordinates);
		
		initBasemap = <span class="hljs-keyword">new</span> esri.layers.ArcGISDynamicMapServiceLayer(<span class="hljs-string">"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer"</span>);
		
		geometryService = <span class="hljs-keyword">new</span> esri.tasks.GeometryService(<span class="hljs-string">"http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer"</span>);
		
        dojo.connect(geometryService, <span class="hljs-string">"onLengthsComplete"</span>, outputDistance);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>dojo.connect(geometryService, “onProjectComplete”, function(graphics) {
call GeometryService.lengths() with projected geometry
      geometryService.lengths(graphics);
});</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>MapSvcAllLayers.add(new MapSvcDef(“BaseMap”, “<a href="http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer">http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer</a>“, ServiceType_Tiled, map, null));</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"DEM"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/LidarCZM/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
		MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"NauticalCharts"</span>, NOAA_NautChartURL, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
		MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"Carto"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/GCAMP314/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));

		MapSvcAllLayers.initializeAllMapSerivceLayers(map, <span class="hljs-string">"Something Else happened"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
			loaded(<span class="hljs-literal">true</span>);
			
			$(<span class="hljs-string">"#button-close-intro"</span>).button(<span class="hljs-string">"enabled"</span>);
			
			map.graphics.onGraphicAdd = map.graphics.onGraphicsClear = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
				isMapGraphicsEmpty(map.graphics.graphics.length);
			};
			
			$(<span class="hljs-string">'#SplashCloseBtn'</span>).button(<span class="hljs-string">'reset'</span>);
			
			hideDEMLayer();

			ko.applyBindings();
			
			navToolbar = <span class="hljs-keyword">new</span> esri.toolbars.Navigation(map);
			drwToolbar = <span class="hljs-keyword">new</span> esri.toolbars.Draw(map);
			
			dojo.connect(map, <span class="hljs-string">'onExtentHistoryChange'</span>, extentHistoryChangeHandler);
			dojo.connect(map, <span class="hljs-string">'onExtentChange'</span>, onMapExtentChange);
			getMapScaleToVariable();</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>dojo.connect(‘onDrawEnd’, measureEnd);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>			
			$(<span class="hljs-string">'#zoomInBtn'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				map.setMapCursor(<span class="hljs-string">"url(images/zoom_in.cur),auto"</span>);
				navToolbar.activate(esri.toolbars.Navigation.ZOOM_IN);
			});

			$(<span class="hljs-string">'#zoomPrevBtn'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				navToolbar.zoomToPrevExtent();
			});
			
			$(<span class="hljs-string">'#zoomFullExtBtn'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				fullExtent();
			});
			
			addOpacityControl();
						
			$(<span class="hljs-string">'#allLayersLink'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				map.removeAllLayers();
				viewModel.currentVisibleLayers.removeAll();
				
				MapSvcAllLayers = <span class="hljs-keyword">new</span> CreateCollection(<span class="hljs-string">"MapSvcList"</span>);
				
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"BaseMap"</span>, <span class="hljs-string">"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer"</span>, ServiceType_Tiled, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"DEM"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/LidarCZM/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"NauticalCharts"</span>, NOAA_NautChartURL, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"Carto"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/GCAMP1213/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));				
				MapSvcAllLayers.initializeAllMapSerivceLayers(map, <span class="hljs-string">"Something Else happened"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).visibleLayers = [];
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).setVisibility(<span class="hljs-literal">false</span>);

					init_layer_controls(map);
					init_id_funct(map);
					currTab(<span class="hljs-string">"All Layers"</span>);
					addOpacityControl();
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>$(‘#timeSliderContainer’).hide();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				timeSliderVisible ( <span class="hljs-literal">false</span> );
			});
			
			$(<span class="hljs-string">'#energyLink'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				map.removeAllLayers();
				viewModel.currentVisibleLayers.removeAll();
				
				MapSvcAllLayers = <span class="hljs-keyword">new</span> CreateCollection(<span class="hljs-string">"MapSvcList"</span>);
				
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"BaseMap"</span>, <span class="hljs-string">"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer"</span>, ServiceType_Tiled, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"DEM"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/LidarCZM/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"NauticalCharts"</span>, NOAA_NautChartURL, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"Energy"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/Energy/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));				
				MapSvcAllLayers.initializeAllMapSerivceLayers(map, <span class="hljs-string">"Something Else happened"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).visibleLayers = [];
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).setVisibility(<span class="hljs-literal">false</span>);

					init_layer_controls(map);
					init_id_funct(map);
					currTab(<span class="hljs-string">"Energy"</span>);
					addOpacityControl();
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>$(‘#timeSliderContainer’).hide();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				timeSliderVisible ( <span class="hljs-literal">false</span> );
			});
			
			$(<span class="hljs-string">'#habitatLink'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				map.removeAllLayers();
				viewModel.currentVisibleLayers.removeAll();
				
				MapSvcAllLayers = <span class="hljs-keyword">new</span> CreateCollection(<span class="hljs-string">"MapSvcList"</span>);
						
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"BaseMap"</span>, <span class="hljs-string">"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer"</span>, ServiceType_Tiled, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"DEM"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/LidarCZM/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"NauticalCharts"</span>, NOAA_NautChartURL, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"Habitat"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/habitat/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));				
				MapSvcAllLayers.initializeAllMapSerivceLayers(map, <span class="hljs-string">"Something Else happened"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).visibleLayers = [];
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).setVisibility(<span class="hljs-literal">false</span>);

					init_layer_controls(map);
					init_id_funct(map);
					currTab(<span class="hljs-string">"Habitat"</span>);
					addOpacityControl();
				});</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>$(‘#timeSliderContainer’).hide();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				timeSliderVisible ( <span class="hljs-literal">false</span> );
				addOpacityControl();
			});
			
			$(<span class="hljs-string">'#fisheriesLink'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				map.removeAllLayers();
				viewModel.currentVisibleLayers.removeAll();
				
				MapSvcAllLayers = <span class="hljs-keyword">new</span> CreateCollection(<span class="hljs-string">"MapSvcList"</span>);
								
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"BaseMap"</span>, <span class="hljs-string">"http://services.arcgisonline.com/ArcGIS/rest/services/Ocean_Basemap/MapServer"</span>, ServiceType_Tiled, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"DEM"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/LidarCZM/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"NauticalCharts"</span>, NOAA_NautChartURL, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));
				MapSvcAllLayers.add(<span class="hljs-keyword">new</span> MapSvcDef(<span class="hljs-string">"Fisheries"</span>, <span class="hljs-string">"http://tulip.gis.gatech.edu:6080/arcgis/rest/services/GACoast/Fisheries/MapServer"</span>, ServiceType_Dynamic, map, <span class="hljs-literal">null</span>));				
				MapSvcAllLayers.initializeAllMapSerivceLayers(map, <span class="hljs-string">"Something Else happened"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).visibleLayers = [];
					map.getLayer( map.layerIds[<span class="hljs-number">1</span>] ).setVisibility(<span class="hljs-literal">false</span>);

					init_layer_controls(map);
					init_id_funct(map);
					
					timeLayerIds.removeAll();
					
					currTab(<span class="hljs-string">"Fisheries"</span>);
					addOpacityControl();
					
					<span class="hljs-built_in">require</span>([<span class="hljs-string">"dojo/_base/xhr"</span>],
						<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(xhr)</span> {</span>
							xhr.get({
								url: <span class="hljs-string">"TimeLayers.xml"</span>,
								handleAs : <span class="hljs-string">"json"</span>,
								load: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(result)</span> {</span>							
									<span class="hljs-keyword">var</span> l = map.getLayer( map.layerIds[<span class="hljs-number">3</span>] );
									console.debug(l);
									
									rr = result;
									
									<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> jjj = <span class="hljs-number">0</span>; jjj &lt; result.length; jjj++ ){
										timeLayerIds.push ( { <span class="hljs-string">"id"</span> : result[jjj].id, <span class="hljs-string">"label"</span> : l.layerInfos[ result[jjj].id ].name } );
									}
									
									$(<span class="hljs-string">'#timeSliderChoicesSelect'</span>).change( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>$(‘#timeSliderChoicesSelect option:selected’).each( function() {</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>											<span class="hljs-keyword">var</span> valToShow = timeSelValue();
											<span class="hljs-keyword">var</span> tLayerIds = timeLayerIds();
											
											console.debug(valToShow);
											
											<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> lll = <span class="hljs-number">0</span>; lll &lt; tLayerIds.length; lll++) {
												<span class="hljs-keyword">if</span>( viewModel.isVisibleLayer( map.layerIds[<span class="hljs-number">3</span>], <span class="hljs-built_in">parseInt</span>(tLayerIds[lll].id) ) ) {
														viewModel.toggleVisibleLayer( { <span class="hljs-string">"mapLayerId"</span> : map.layerIds[<span class="hljs-number">3</span>], <span class="hljs-string">"esriLayer"</span> : { id: <span class="hljs-built_in">parseInt</span>(tLayerIds[lll].id) } } )
													}
											}
											
											viewModel.toggleVisibleLayer( { <span class="hljs-string">"mapLayerId"</span> : map.layerIds[<span class="hljs-number">3</span>], <span class="hljs-string">"esriLayer"</span> : { id: <span class="hljs-built_in">parseInt</span>(valToShow) } } )
											l.refresh();</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>});</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>									});
								}
							}
						)}
					);
					
					<span class="hljs-keyword">var</span> timeExtent = <span class="hljs-keyword">new</span> esri.TimeExtent();
					timeExtent.startTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-string">"1/1/2011 EST"</span>);
					map.setTimeExtent(timeExtent);

					<span class="hljs-keyword">if</span>(timeSlider == <span class="hljs-literal">null</span>) {
						timeSlider = <span class="hljs-keyword">new</span> esri.dijit.TimeSlider({
						  style: <span class="hljs-string">"width: 800px;"</span>
						}, dojo.byId(<span class="hljs-string">"timeSliderDiv"</span>));
					}
					
					map.setTimeSlider(timeSlider);
					timeSlider.setThumbCount(<span class="hljs-number">2</span>);
					
					<span class="hljs-keyword">var</span> layerTimeExtent = map.getLayer( map.layerIds[<span class="hljs-number">3</span>] ).timeInfo.timeExtent;
					layerTimeExtent.startTime = timeExtent.startTime;
					timeSlider.createTimeStopsByTimeInterval(layerTimeExtent, <span class="hljs-number">1</span>, <span class="hljs-string">'esriTimeUnitsMonths'</span>);
					timeSlider.setThumbMovingRate(<span class="hljs-number">1500</span>);			
					timeSlider.setLoop(<span class="hljs-literal">true</span>);
					timeSlider.setLabels([<span class="hljs-string">"Jan"</span>, <span class="hljs-string">"Feb"</span>, <span class="hljs-string">"Mar"</span>, <span class="hljs-string">"Apr"</span>, <span class="hljs-string">"May"</span>, <span class="hljs-string">"Jun"</span>, <span class="hljs-string">"Jul"</span>, <span class="hljs-string">"Aug"</span>, <span class="hljs-string">"Sep"</span>, <span class="hljs-string">"Oct"</span>, <span class="hljs-string">"Nov"</span>, <span class="hljs-string">"Dec"</span>]);
					timeSlider.startup();</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>$(‘#timeSliderContainer’).css(‘display’, ‘inline’);
$(‘#timeSliderChoices’).css(‘display’, ‘inline’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					timeSliderVisible( <span class="hljs-literal">true</span> );
					addOpacityControl();
				});
			});

			$(<span class="hljs-string">'#panBtn'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
				map.setMapCursor(<span class="hljs-string">"pointer"</span>);
				navToolbar.activate(esri.toolbars.Navigation.PAN);
			});
			
			scalebar = <span class="hljs-keyword">new</span> esri.dijit.Scalebar({
				map: map,
				<span class="hljs-comment">/*attachTo:"top-left"*/</span>
			});
					
			legend = <span class="hljs-keyword">new</span> esri.dijit.Legend({
				map:map
			},<span class="hljs-string">"legendSection"</span>);
			
			createBasemapGallery();

			<span class="hljs-keyword">var</span> measurement = <span class="hljs-keyword">new</span> esri.dijit.Measurement({
				map: map
			}, dojo.byId(<span class="hljs-string">'measurementDiv'</span>));

			measurement.startup();			
			measurement.hideTool(<span class="hljs-string">'location'</span>);
			
			legend.startup();
			init_layer_controls(map);
			init_id_funct(map);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <pre><code>    addLayerToMap(NOAA_NautChartURL, <span class="hljs-string">"NOAA Nautical Charts"</span>);
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>		});
			
		<span class="hljs-keyword">var</span> args = {
			url: <span class="hljs-string">"http://carto.gis.gatech.edu/proxypage_net/sites.ashx"</span>,
			handleAs: <span class="hljs-string">"json"</span>,
			load: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
				serviceCatalog = [];
				
				<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
					<span class="hljs-keyword">if</span>(data[i].label != <span class="hljs-string">""</span>) {
						serviceCatalog.push(
							{ url: data[i].url, label: data[i].label, id: i+<span class="hljs-number">1</span>}
						);
					}
				}
			}
		};
					
		esri.request(args);
}

<span class="hljs-keyword">var</span> rr = <span class="hljs-literal">null</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> {</span>
	esriConfig.defaults.io.proxyUrl = <span class="hljs-string">"http://carto.gis.gatech.edu/proxypage_net/proxy.ashx"</span>;
	esriConfig.defaults.io.alwaysUseProxy = <span class="hljs-literal">true</span>;
	
	esri.config.defaults.io.corsEnabledServers.push(<span class="hljs-string">"http://carto.gis.gatech.edu"</span>);
	esri.config.defaults.io.corsEnabledServers.push(<span class="hljs-string">"http://www.csc.noaa.gov"</span>);
	esri.config.defaults.io.corsEnabledServers.push(<span class="hljs-string">"http://ocs-gis.ncd.noaa.gov"</span>);
	esri.config.defaults.io.corsEnabledServers.push(<span class="hljs-string">"http://services.arcgisonline.com"</span>);
	esri.config.defaults.io.corsEnabledServers.push(<span class="hljs-string">"http://tasks.arcgisonline.com"</span>);

	extents = [
		<span class="hljs-comment">/*
		new esri.geometry.Extent( {"ymin": 31, "ymax": 33, "xmin" : -87, "xmax": -78, "spatialReference": { "wkid" : 4269 } } ) , //all
		new esri.geometry.Extent( {"ymin": 31, "ymax": 33, "xmin" : -87, "xmax": -78, "spatialReference": { "wkid" : 4269 } } ) , //on-shore
		new esri.geometry.Extent( {"ymin": 28, "ymax": 35, "xmin" : -81, "xmax": -73, "spatialReference": { "wkid" : 4269 } } ) , //coast
		new esri.geometry.Extent( {"ymin": 31, "ymax": 33, "xmin" : -87, "xmax": -78, "spatialReference": { "wkid" : 4269 } } )   //ocean
		*/</span>
		<span class="hljs-keyword">new</span> esri.geometry.Extent( {<span class="hljs-string">"ymin"</span>: <span class="hljs-number">30.561</span>, <span class="hljs-string">"ymax"</span>: <span class="hljs-number">32.422</span>, <span class="hljs-string">"xmin"</span>: -<span class="hljs-number">82.319</span>, <span class="hljs-string">"xmax"</span>: -<span class="hljs-number">79.973</span>, <span class="hljs-string">"spatialReference"</span>: { <span class="hljs-string">"wkid"</span> : <span class="hljs-number">4269</span> }} )
	];
	
	initialExtent = extents[<span class="hljs-number">0</span>];
		
	cvtLatLongExtent_2_WebMercator( initialExtent, prepare_map_when_extents_finished);
}

<span class="hljs-keyword">var</span> map_x_coord = ko.observable(<span class="hljs-string">"-00.00"</span>);
<span class="hljs-keyword">var</span> map_y_coord = ko.observable(<span class="hljs-string">"00.00"</span>);

<span class="hljs-keyword">var</span> abs_map_scale = ko.observable(<span class="hljs-string">"0"</span>);

<span class="hljs-keyword">var</span> lastMapEv = <span class="hljs-literal">null</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMapScaleToVariable</span><span class="hljs-params">()</span> {</span>
	abs_map_scale( <span class="hljs-string">"1: "</span> + (<span class="hljs-built_in">Math</span>.round(map.getScale()/<span class="hljs-number">100</span>)*<span class="hljs-number">100</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMapExtentChange</span><span class="hljs-params">(extent,delta,levelChange,lod)</span> {</span>
	getMapScaleToVariable();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showMouseCoordinates</span><span class="hljs-params">(e)</span> {</span>
	lastMapEv = e;
	
	<span class="hljs-keyword">var</span> mp = esri.geometry.webMercatorToGeographic(e.mapPoint);</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>DMS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span>(<span class="hljs-literal">false</span>) {
		<span class="hljs-keyword">var</span> degX = <span class="hljs-built_in">Math</span>.floor(mp.x);
		<span class="hljs-keyword">var</span> degY = <span class="hljs-built_in">Math</span>.floor(mp.y);
		
		<span class="hljs-keyword">var</span> minX = (<span class="hljs-built_in">Math</span>.abs(mp.x - degX) * <span class="hljs-number">60</span>);
		<span class="hljs-keyword">var</span> minY = (<span class="hljs-built_in">Math</span>.abs(mp.y - degY) * <span class="hljs-number">60</span>);
		
		<span class="hljs-keyword">var</span> secX = (<span class="hljs-built_in">Math</span>.abs(minX - <span class="hljs-built_in">Math</span>.floor(minX)) * <span class="hljs-number">60</span>);
		<span class="hljs-keyword">var</span> secY = (<span class="hljs-built_in">Math</span>.abs(minY - <span class="hljs-built_in">Math</span>.floor(minY)) * <span class="hljs-number">60</span>);
		
		map_x_coord(degX + <span class="hljs-string">"* "</span> + <span class="hljs-built_in">Math</span>.floor(minX) + <span class="hljs-string">"\' "</span> + <span class="hljs-built_in">Math</span>.floor(secX) + <span class="hljs-string">"\""</span> );
		map_y_coord(degY + <span class="hljs-string">"* "</span> + <span class="hljs-built_in">Math</span>.floor(minY) + <span class="hljs-string">"\' "</span> + <span class="hljs-built_in">Math</span>.floor(secY) + <span class="hljs-string">"\""</span> );
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>DD</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">else</span> {
		map_x_coord(mp.x.toFixed(<span class="hljs-number">4</span>));
		map_y_coord(mp.y.toFixed(<span class="hljs-number">4</span>))
	}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init_id_funct</span><span class="hljs-params">(map)</span> {</span>
	identifyTask = <span class="hljs-keyword">new</span> esri.tasks.IdentifyTask(
		map.getLayer(map.layerIds[<span class="hljs-number">2</span>]).url
	<span class="hljs-comment">/* "http://carto.gis.gatech.edu/ArcGIS/rest/services/TidalEnergyTest/MapServer"*/</span> );
	
	identifyParams = <span class="hljs-keyword">new</span> esri.tasks.IdentifyParameters();
	identifyParams.tolerance = <span class="hljs-number">1</span>;
	identifyParams.returnGeometry = <span class="hljs-literal">true</span>;
	identifyParams.layerIds = []; <span class="hljs-comment">//[12,13,17];//[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17];</span>
	identifyParams.layerOption = esri.tasks.IdentifyParameters.LAYER_OPTION_VISIBLE;
	identifyParams.width = map.width;
	identifyParams.height = map.height;
	
	map.infoWindow.resize(<span class="hljs-number">415</span>, <span class="hljs-number">200</span>);
	map.infoWindow.setContent(<span class="hljs-string">"_"</span>);
	map.infoWindow.setTitle(<span class="hljs-string">"Identify Results"</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">return_to_LayerList</span><span class="hljs-params">()</span> {</span>
	$(<span class="hljs-string">'#layerTabLink'</span>).tab(<span class="hljs-string">'show'</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fullExtent</span><span class="hljs-params">()</span> {</span>
	map.setExtent(initialExtent);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extentHistoryChangeHandler</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>dijit.byId(“zoomprev”).disabled = navToolbar.isFirstExtent();
dijit.byId(“zoomnext”).disabled = navToolbar.isLastExtent();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sliderChanged</span><span class="hljs-params">(value)</span> {</span>
	<span class="hljs-keyword">var</span> num = <span class="hljs-built_in">Math</span>.floor(value/<span class="hljs-number">100</span> * extents.length);
	
	<span class="hljs-keyword">if</span>(value == <span class="hljs-number">100</span>) num = extents.length - <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>console.debug(num);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	
	cvtLatLongExtent_2_WebMercator( extents[num], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span> {</span>
		initialExtent = res[<span class="hljs-number">0</span>];
		fullExtent();
	});
}

<span class="hljs-keyword">var</span> handleIdentify = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">var</span> handleIdentifySummary = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">var</span> tabs;
<span class="hljs-keyword">var</span> jpanes = <span class="hljs-literal">null</span>;

<span class="hljs-keyword">var</span> lastGraphic = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">var</span> multipleSelectSummary = <span class="hljs-literal">null</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jQueryReady</span><span class="hljs-params">()</span> {</span>
	$(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
		<span class="hljs-comment">/*jpanes = $('.scroll-pane').jScrollPane({
			showArrows : true,
			verticalArrowPositions: 'split',
			horizontalArrowPositions: 'split',
			maintainPosition : false,
			verticalDragMinHeight: 20,
			verticalDragMaxHeight: 20,
			horizontalDragMinWidth: 20,
			horizontalDragMaxWidth: 20,
			scrollbarWidth: 250,
			scrollbarHeight: 250,
			autoReinitialise : true
		});*/</span>
		
		tabs = $(<span class="hljs-string">'a[data-toggle="tab"]'</span>).on(<span class="hljs-string">'shown'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> {</span>
			<span class="hljs-keyword">if</span>( $(e.target).attr(<span class="hljs-string">'href'</span>) == <span class="hljs-string">"#identifyPane"</span>) {
				map.setMapCursor(<span class="hljs-string">"url(images/id_cursor.cur),auto"</span>);
				handleIdentify = dojo.connect(map, <span class="hljs-string">"onClick"</span>, doIdentify);
				
			}
			<span class="hljs-keyword">else</span> {
				map.setMapCursor(<span class="hljs-string">"default"</span>);
				<span class="hljs-keyword">if</span>(handleIdentify != <span class="hljs-literal">null</span>) {
					dojo.disconnect(handleIdentify);
					handleIdentify = <span class="hljs-literal">null</span>;
				}
			}
			
			<span class="hljs-keyword">if</span>( $(e.target).attr(<span class="hljs-string">'href'</span>) == <span class="hljs-string">"#identifyPaneSumm"</span> ) {
				resetSummaryPane();
				drwToolbar.activate(esri.toolbars.Draw.POLYGON);

				dojo.connect(drwToolbar, <span class="hljs-string">"onDrawEnd"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(geometry)</span> {</span>
						map.graphics.clear();
					  
						<span class="hljs-keyword">var</span> graphic = map.graphics.add(<span class="hljs-keyword">new</span> esri.Graphic(geometry, <span class="hljs-keyword">new</span> esri.symbol.SimpleLineSymbol()));
						lastGraphic = graphic;</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>doMeasure([graphic]);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
						<span class="hljs-keyword">var</span> geometryService = <span class="hljs-keyword">new</span> esri.tasks.GeometryService(<span class="hljs-string">"http://tasks.arcgisonline.com/ArcGIS/rest/services/Geometry/GeometryServer"</span>);
						<span class="hljs-keyword">var</span> PrjParams = <span class="hljs-keyword">new</span> esri.tasks.ProjectParameters();
						PrjParams.geometries = [geometry];
						PrjParams.outSR = <span class="hljs-keyword">new</span> esri.SpatialReference(<span class="hljs-number">32618</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>console.debug(geometry);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					
						geometryService.project(PrjParams, doSummaryQuery );</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>doSummaryQuery( [geometry] );
console.debug(geometry);</p>

            </div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>doSummaryQuery([geometry]);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				});
			}
			<span class="hljs-keyword">else</span> {
				drwToolbar.deactivate();
			}</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>alert($(e.target).attr(‘href’)) //e.target // activated tab
e.relatedTarget // previous tab
$(‘.scroll-pane’).jScrollPane();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		})
	
		$(<span class="hljs-string">'#intro'</span>).dialog({
			modal: <span class="hljs-literal">true</span>,
			buttons: [{
				text: <span class="hljs-string">"I Understand"</span>,
				id: <span class="hljs-string">"button-close-intro"</span>,
				disabled: <span class="hljs-literal">true</span>,
				click:
					<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> 
						$(<span class="hljs-keyword">this</span>).dialog(<span class="hljs-string">"close"</span>);
				}
				}],
			close: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
				map.resize();
			},
			title: <span class="hljs-string">"Georgia Coastal and Marine Planner"</span>,
			resizable: <span class="hljs-literal">false</span>,
			draggable: <span class="hljs-literal">false</span>,
			closeOnEscape: <span class="hljs-literal">false</span>
		});
		
		$(<span class="hljs-string">'#SplashCloseBtn'</span>).button(<span class="hljs-string">'loading'</span>);
			
		$(<span class="hljs-string">'#meas'</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
			$(<span class="hljs-string">'#measurePopoutPanel'</span>).dialog({width:<span class="hljs-number">250</span>, title:<span class="hljs-string">"Measurement"</span>});
		});
	});
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetSummaryPane</span><span class="hljs-params">()</span> {</span>
	<span class="hljs-keyword">if</span>( multipleSelectSummary == <span class="hljs-literal">null</span>) {
		multipleSelectSummary = $(<span class="hljs-string">'#summarySelectList'</span>).multipleSelect().data();
	}
	
	multipleSelectSummary.multipleSelect.refresh();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doClearMapGraphics</span><span class="hljs-params">()</span> {</span>
	map.graphics.clear();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doLoadLegendElements</span><span class="hljs-params">(mapSvc)</span> {</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doToggleSidebar</span><span class="hljs-params">()</span> {</span>
	isSidebarVisible(!isSidebarVisible());
	map.resize();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doShowPrintDlg</span><span class="hljs-params">()</span> {</span>
	$(<span class="hljs-string">"#printing-popover"</span>).show();
}

$(document).ready(jQueryReady);
dojo.addOnLoad(init);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
